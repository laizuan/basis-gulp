!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.page=b()}(this,function(){"use strict";function h(a){for(var f,h,i,j,k,m,n,o,p,q,r,s,t,u,b=[],c=0,d=0,e="";null!=(f=g.exec(a));)h=f[0],i=f[1],j=f.index,e+=a.slice(d,j),d=j+h.length,i?e+=i[1]:(e&&(b.push(e),e=""),k=f[2],m=f[3],n=f[4],o=f[5],p=f[6],q=f[7],r="+"===p||"*"===p,s="?"===p||"*"===p,t=k||"/",u=n||o||(q?".*":"[^"+t+"]+?"),b.push({name:m||c++,prefix:k||"",delimiter:t,optional:s,repeat:r,pattern:l(u)}));return d<a.length&&(e+=a.substr(d)),e&&b.push(e),b}function i(a){return j(h(a))}function j(b){var d,c=new Array(b.length);for(d=0;d<b.length;d++)"object"==typeof b[d]&&(c[d]=new RegExp("^"+b[d].pattern+"$"));return function(d){var g,h,i,j,k,e="",f=d||{};for(g=0;g<b.length;g++)if(h=b[g],"string"!=typeof h){if(i=f[h.name],null==i){if(h.optional)continue;throw new TypeError('Expected "'+h.name+'" to be defined')}if(a(i)){if(!h.repeat)throw new TypeError('Expected "'+h.name+'" to not repeat, but received "'+i+'"');if(0===i.length){if(h.optional)continue;throw new TypeError('Expected "'+h.name+'" to not be empty')}for(k=0;k<i.length;k++){if(j=encodeURIComponent(i[k]),!c[g].test(j))throw new TypeError('Expected all "'+h.name+'" to match "'+h.pattern+'", but received "'+j+'"');e+=(0===k?h.prefix:h.delimiter)+j}}else{if(j=encodeURIComponent(i),!c[g].test(j))throw new TypeError('Expected "'+h.name+'" to match "'+h.pattern+'", but received "'+j+'"');e+=h.prefix+j}}else e+=h;return e}}function k(a){return a.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function l(a){return a.replace(/([=!:$\/()])/g,"\\$1")}function m(a,b){return a.keys=b,a}function n(a){return a.sensitive?"":"i"}function o(a,b){var d,c=a.source.match(/\((?!\?)/g);if(c)for(d=0;d<c.length;d++)b.push({name:d,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return m(a,b)}function p(a,b,c){var e,f,d=[];for(e=0;e<a.length;e++)d.push(s(a[e],b,c).source);return f=new RegExp("(?:"+d.join("|")+")",n(c)),m(f,b)}function q(a,b,c){var f,d=h(a),e=r(d,c);for(f=0;f<d.length;f++)"string"!=typeof d[f]&&b.push(d[f]);return m(e,b)}function r(a,b){var c,d,e,f,g,h,i,j,l;for(b=b||{},c=b.strict,d=b.end!==!1,e="",f=a[a.length-1],g="string"==typeof f&&/\/$/.test(f),h=0;h<a.length;h++)i=a[h],"string"==typeof i?e+=k(i):(j=k(i.prefix),l=i.pattern,i.repeat&&(l+="(?:"+j+l+")*"),l=i.optional?j?"(?:"+j+"("+l+"))?":"("+l+")?":j+"("+l+")",e+=l);return c||(e=(g?e.slice(0,-2):e)+"(?:\\/(?=$))?"),e+=d?"$":c&&g?"":"(?=\\/|$)",new RegExp("^"+e,n(b))}function s(b,c,d){return c=c||[],a(c)?d||(d={}):(d=c,c=[]),b instanceof RegExp?o(b,c,d):a(b)?p(b,c,d):q(b,c,d)}function z(a){this.callbacks=[],this.exits=[],this.current="",this.len=0,this._dispatch=!0,this._decodeURLComponents=!0,this._base="",this._strict=!1,this._running=!1,this._hashbang=!1,this.clickHandler=this.clickHandler.bind(this),this._onpopstate=this._onpopstate.bind(this),this.configure(a)}function A(){function c(){return B.apply(b,arguments)}var b=new z;return c.callbacks=b.callbacks,c.exits=b.exits,c.base=b.base.bind(b),c.strict=b.strict.bind(b),c.start=b.start.bind(b),c.stop=b.stop.bind(b),c.show=b.show.bind(b),c.back=b.back.bind(b),c.redirect=b.redirect.bind(b),c.replace=b.replace.bind(b),c.dispatch=b.dispatch.bind(b),c.exit=b.exit.bind(b),c.configure=b.configure.bind(b),c.sameOrigin=b.sameOrigin.bind(b),c.clickHandler=b.clickHandler.bind(b),c.create=A,Object.defineProperty(c,"len",{get:function(){return b.len},set:function(a){b.len=a}}),Object.defineProperty(c,"current",{get:function(){return b.current},set:function(a){b.current=a}}),c.Context=D,c.Route=E,c}function B(a,b){var c,d;if("function"==typeof a)return B.call(this,"*",a);if("function"==typeof b)for(c=new E(a,null,this),d=1;d<arguments.length;++d)this.callbacks.push(c.middleware(arguments[d]));else"string"==typeof a?this["string"==typeof b?"redirect":"show"](a,b):this.start(a)}function C(a){var b,c,d;a.handled||(c=this,d=c._window,b=c._hashbang?y&&this._getBase()+d.location.hash.replace("#!",""):y&&d.location.pathname+d.location.search,b!==a.canonicalPath&&(c.stop(),a.handled=!1,y&&(d.location.href=a.canonicalPath)))}function D(a,b,c){var h,i,d=this.page=c||B,e=d._window,f=d._hashbang,g=d._getBase();if("/"===a[0]&&0!==a.indexOf(g)&&(a=g+(f?"#!":"")+a),h=a.indexOf("?"),this.canonicalPath=a,this.path=a.replace(g,"")||"/",f&&(this.path=this.path.replace("#!","")||"/"),this.title=t&&e.document.title,this.state=b||{},this.state.path=a,this.querystring=~h?d._decodeURLEncodedURIComponent(a.slice(h+1)):"",this.pathname=d._decodeURLEncodedURIComponent(~h?a.slice(0,h):a),this.params={},this.hash="",!f){if(!~this.path.indexOf("#"))return;i=this.path.split("#"),this.path=this.pathname=i[0],this.hash=d._decodeURLEncodedURIComponent(i[1])||"",this.querystring=this.querystring.split("#")[0]}}function E(a,c,d){this.page=d||F;var f=c||{};f.strict=f.strict||d._strict,this.path="*"===a?"(.*)":a,this.method="GET",this.regexp=b(this.path,this.keys=[],f)}var t,u,v,w,x,y,F,G,a=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)},b=s,c=h,d=i,e=j,f=r,g=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");return b.parse=c,b.compile=d,b.tokensToFunction=e,b.tokensToRegExp=f,t="undefined"!=typeof document,u="undefined"!=typeof window,v="undefined"!=typeof history,w="undefined"!=typeof process,x=t&&document.ontouchstart?"touchstart":"click",y=u&&!(!window.history.location&&!window.location),z.prototype.configure=function(a){var c,b=a||{};this._window=b.window||u&&window,this._dispatch=b.dispatch!==!1,this._decodeURLComponents=b.decodeURLComponents!==!1,this._popstate=b.popstate!==!1&&u,this._click=b.click!==!1&&t,this._hashbang=!!b.hashbang,c=this._window,this._popstate?c.addEventListener("popstate",this._onpopstate,!1):u&&c.removeEventListener("popstate",this._onpopstate,!1),this._click?c.document.addEventListener(x,this.clickHandler,!1):t&&c.document.removeEventListener(x,this.clickHandler,!1),this._hashbang&&u&&!v?c.addEventListener("hashchange",this._onpopstate,!1):u&&c.removeEventListener("hashchange",this._onpopstate,!1)},z.prototype.base=function(a){return 0===arguments.length?this._base:(this._base=a,void 0)},z.prototype._getBase=function(){var b,a=this._base;return a?a:(b=u&&this._window&&this._window.location,u&&this._hashbang&&b&&"file:"===b.protocol&&(a=b.pathname,a=a.substring(0,a.lastIndexOf("/"))),a)},z.prototype.strict=function(a){return 0===arguments.length?this._strict:(this._strict=a,void 0)},z.prototype.start=function(a){var b,c,d;this.configure(a),this._dispatch&&(this._running=!0,y&&(c=this._window,d=c.location,b=this._hashbang&&~d.hash.indexOf("#!")?d.hash.substr(2)+d.search:this._hashbang?d.search+d.hash:d.pathname+d.search+d.hash),this.replace(b,null,!0,this._dispatch))},z.prototype.stop=function(){if(this._running){this.current="",this.len=0,this._running=!1;var a=this._window;t&&a.document.removeEventListener(x,this.clickHandler,!1),u&&a.removeEventListener("popstate",this._onpopstate,!1),u&&a.removeEventListener("hashchange",this._onpopstate,!1)}},z.prototype.show=function(a,b,c,d){var e=new D(a,b,this),f=this.prevContext;return this.prevContext=e,this.current=e.path,this._dispatch&&this.dispatch(e,f),!1!==e.handled&&!1!==d&&e.pushState(),e},z.prototype.back=function(a,b){var d,c=this;this.len>0?(d=this._window,v&&d.history.back(),this.len--):a?setTimeout(function(){c.show(a,b)}):setTimeout(function(){c.show(c._getBase(),b)})},z.prototype.redirect=function(a,b){var c=this;"string"==typeof a&&"string"==typeof b&&B.call(this,a,function(){setTimeout(function(){c.replace(b)},0)}),"string"==typeof a&&"undefined"==typeof b&&setTimeout(function(){c.replace(a)},0)},z.prototype.replace=function(a,b,c,d){var e=new D(a,b,this),f=this.prevContext;return this.prevContext=e,this.current=e.path,e.init=c,e.save(),!1!==d&&this.dispatch(e,f),e},z.prototype.dispatch=function(a,b){function f(){var a=e.exits[d++];return a?(a(b,f),void 0):g()}function g(){var b=e.callbacks[c++];return a.path!==e.current?(a.handled=!1,void 0):b?(b(a,g),void 0):C.call(e,a)}var c=0,d=0,e=this;b?f():g()},z.prototype.exit=function(a){var c,d;if("function"==typeof a)return this.exit("*",a);for(c=new E(a,null,this),d=1;d<arguments.length;++d)this.exits.push(c.middleware(arguments[d]))},z.prototype.clickHandler=function(a){var b,c,d,e,f,g,h,i;if(1===this._which(a)&&!(a.metaKey||a.ctrlKey||a.shiftKey||a.defaultPrevented)){if(b=a.target,c=a.path||(a.composedPath?a.composedPath():null))for(d=0;d<c.length;d++)if(c[d].nodeName&&"A"===c[d].nodeName.toUpperCase()&&c[d].href){b=c[d];break}for(;b&&"A"!==b.nodeName.toUpperCase();)b=b.parentNode;b&&"A"===b.nodeName.toUpperCase()&&(e="object"==typeof b.href&&"SVGAnimatedString"===b.href.constructor.name,b.hasAttribute("download")||"external"===b.getAttribute("rel")||(f=b.getAttribute("href"),(this._hashbang||!this._samePath(b)||!b.hash&&"#"!==f)&&(f&&f.indexOf("mailto:")>-1||(e?b.target.baseVal:b.target)||(e||this.sameOrigin(b.href))&&(g=e?b.href.baseVal:b.pathname+b.search+(b.hash||""),g="/"!==g[0]?"/"+g:g,w&&g.match(/^\/[a-zA-Z]:\//)&&(g=g.replace(/^\/[a-zA-Z]:\//,"/")),h=g,i=this._getBase(),0===g.indexOf(i)&&(g=g.substr(i.length)),this._hashbang&&(g=g.replace("#!","")),(!i||h!==g||y&&"file:"===this._window.location.protocol)&&(a.preventDefault(),this.show(h))))))}},z.prototype._onpopstate=function(){var a=!1;return u?(t&&"complete"===document.readyState?a=!0:window.addEventListener("load",function(){setTimeout(function(){a=!0},0)}),function(b){var c,d,e;a&&(c=this,b.state?(d=b.state.path,c.replace(d,b.state)):y&&(e=c._window.location,c.show(e.pathname+e.search+e.hash,void 0,void 0,!1)))}):function(){}}(),z.prototype._which=function(a){return a=a||u&&this._window.event,null==a.which?a.button:a.which},z.prototype._toURL=function(a){var c,b=this._window;return"function"==typeof URL&&y?new URL(a,b.location.toString()):t?(c=b.document.createElement("a"),c.href=a,c):void 0},z.prototype.sameOrigin=function(a){var b,c,d;return a&&y?(b=this._toURL(a),c=this._window,d=c.location,d.protocol===b.protocol&&d.hostname===b.hostname&&d.port===b.port):!1},z.prototype._samePath=function(a){var b,c;return y?(b=this._window,c=b.location,a.pathname===c.pathname&&a.search===c.search):!1},z.prototype._decodeURLEncodedURIComponent=function(a){return"string"!=typeof a?a:this._decodeURLComponents?decodeURIComponent(a.replace(/\+/g," ")):a},D.prototype.pushState=function(){var a=this.page,b=a._window,c=a._hashbang;a.len++,v&&b.history.pushState(this.state,this.title,c&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},D.prototype.save=function(){var a=this.page;v&&"file:"!==a._window.location.protocol&&a._window.history.replaceState(this.state,this.title,a._hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},E.prototype.middleware=function(a){var b=this;return function(c,d){return b.match(c.path,c.params)?a(c,d):(d(),void 0)}},E.prototype.match=function(a,b){var g,h,i,j,c=this.keys,d=a.indexOf("?"),e=~d?a.slice(0,d):a,f=this.regexp.exec(decodeURIComponent(e));if(!f)return!1;for(g=1,h=f.length;h>g;++g)i=c[g-1],j=this.page._decodeURLEncodedURIComponent(f[g]),void 0===j&&hasOwnProperty.call(b,i.name)||(b[i.name]=j);return!0},F=A(),G=F,B.default=F,G});